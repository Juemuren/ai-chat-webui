# 开发日志

## 确定核心技术栈

使用 React + TypeScript + Vite 的技术栈

更多细节可参阅[这个](TECHSTACK.md)文档

## 初始化项目

新建项目并安装依赖

```sh
npm create vite@latest
npm install
```

安装依赖时自动生成了锁文件。之后还要再固定住 nodejs 的版本

```sh
echo "24.11.1" > .nvmrc
```

模板中缺少了格式化工具。按照 [prettier 官方文档](https://prettier.io/docs/install)的说明进行安装和配置

```sh
npm install --save-dev --save-exact prettier
node --eval "fs.writeFileSync('.prettierrc','{}\n')"
node --eval "fs.writeFileSync('.prettierignore','# Ignore\n')"
# 然后修改 .prettierrc 和 .prettierignore 文件，再格式化代码
npx prettier . --write
```

## 确定 MVP 功能边界

1. **基础对话界面**
   - 渲染对话区域，支持用户与 AI 的消息气泡展示。
   - 区分用户和 AI 消息样式（包括头像、角色名称）。
   - 对话区域自动滚动至最新消息。

2. **消息输入与发送**
   - 支持多行文本输入框。
   - 支持点击发送按钮或按 Enter 键发送消息。
   - 发送后清空输入框。

3. **AI 回复模拟**
   - 发送用户消息后，立即显示 AI 加载状态。
   - 先本地运行 ollama 服务作为 API 端点，后续通过 mock 模拟 AI 回复。

4. **消息状态管理**
   - 管理消息的发送状态：loading（加载中）、sent（已发送）、error（发送失败）。
   - 发送失败时显示错误提示。

## 逐步拓展应用

这里只记录功能/特性的增加，重写重构、样式修改、错误修复等均被忽略。可以在 Git 提交记录中查看完整的开发活动。

要了解具体的实现细节请参阅[这个](IMPL.md)文档

- 新增 *Markdown 解析渲染* 功能，并自定义了基本的样式
- 增强**代码块**功能，支持 *显示语言名称*、*语法高亮*、*一键复制*
- 改为使用**流式**接口，并实现流式响应的打字机效果
- 增强**提示**信息，AI 回复**加载**时会显示正在思考，**出错**后会显示错误信息
- 新增 *复制内容* 和 *重新生成* 功能，可以一键复制回复内容和让 AI 重新生成回复
- 新增 *单个会话历史* 功能，记录缓存在浏览器中
- 改为使用 **Mock** 拦截请求模拟响应，并可以进行流式传输
- 增强 **Mock** 功能，内置 *Markdown 渲染*、*代码块*、*长文本* 测试
- 增强**打包**功能，新的打包模式允许使用 **Mock** 模拟数据
- 新增 *停止* 功能，可以强制结束 AI 的回复
- 新增 *多个会话历史* 功能，可以新建会话、切换会话、删除会话
- 增强**会话历史**功能，允许自定义会话名称
